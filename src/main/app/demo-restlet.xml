<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:tracking="http://www.mulesoft.org/schema/mule/ee/tracking" xmlns:dw="http://www.mulesoft.org/schema/mule/ee/dw"
	xmlns:netsuite="http://www.mulesoft.org/schema/mule/netsuite"
	xmlns:json="http://www.mulesoft.org/schema/mule/json" xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:spring="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-current.xsd
http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/netsuite http://www.mulesoft.org/schema/mule/netsuite/current/mule-netsuite.xsd
http://www.mulesoft.org/schema/mule/json http://www.mulesoft.org/schema/mule/json/current/mule-json.xsd
http://www.mulesoft.org/schema/mule/ee/dw http://www.mulesoft.org/schema/mule/ee/dw/current/dw.xsd
http://www.mulesoft.org/schema/mule/ee/tracking http://www.mulesoft.org/schema/mule/ee/tracking/current/mule-tracking-ee.xsd">
	<http:listener-config name="HTTP_Listener_Configuration"
		host="0.0.0.0" port="8081" doc:name="HTTP Listener Configuration" />
    <netsuite:config-request-level-authentication
        name="NetSuite__Request_Level_Authentication" email="${netsuite.email}"
        password="${netsuite.password}" account="${netsuite.account}" roleId="${netsuite.roleId}"
        applicationId="${netsuite.applicationId}" doc:name="NetSuite: Request Level Authentication" />
    <flow name="html-form-flow">
        <http:listener config-ref="HTTP_Listener_Configuration" path="/" doc:name="/"/>
        <parse-template location="form.html" doc:name="Parse Template"/>
        <set-property propertyName="Content-Type" value="text/html" doc:name="Content-Type"/>
    </flow>
    <flow name="restletGet">
        <http:listener config-ref="HTTP_Listener_Configuration" path="/get" doc:name="/get"/>
        <dw:transform-message doc:name="Transform GET Input">
            <dw:set-payload><![CDATA[%dw 1.0
%output application/java
---
{
    "id": inboundProperties."http.query.params".'id',
    "recordtype": inboundProperties."http.query.params".'recordtype'
}]]></dw:set-payload>
        </dw:transform-message>
        <netsuite:call-restlet-get config-ref="NetSuite__Request_Level_Authentication" deploy="1" script="546" doc:name="NetSuite RESTlet (GET)"/>
        <json:object-to-json-transformer doc:name="Map to JSON"/>
        <logger level="INFO" doc:name="Logger"/>
    </flow>
    <flow name="restletPost">
        <http:listener config-ref="HTTP_Listener_Configuration" path="/post" doc:name="/post"/>
        <dw:transform-message doc:name="Transform POST Input">
            <dw:set-payload><![CDATA[%dw 1.0
%output application/java
---
payload]]></dw:set-payload>
        </dw:transform-message>
        <netsuite:call-restlet-get config-ref="NetSuite__Request_Level_Authentication" deploy="1" script="546" doc:name="NetSuite RESTlet (POST)"/>
        <json:object-to-json-transformer doc:name="Map to JSON"/>
        <logger level="INFO" doc:name="Logger"/>
    </flow>
    <flow name="restletDelete">
        <http:listener config-ref="HTTP_Listener_Configuration" path="/delete" doc:name="/delete"/>
        <dw:transform-message doc:name="Transform DELETE Input">
            <dw:set-payload><![CDATA[%dw 1.0
%output application/java
---
{
    "id": inboundProperties."http.query.params".'id',
    "recordtype": inboundProperties."http.query.params".'recordtype'
}]]></dw:set-payload>
        </dw:transform-message>
        <netsuite:call-restlet-delete config-ref="NetSuite__Request_Level_Authentication" deploy="1" script="546" doc:name="NetSuite RESTlet (DELETE)"/>
        <set-payload value="Record deleted successfully" doc:name="Set Payload"/>
        <logger  level="INFO" doc:name="Logger"/>
    </flow>
</mule>